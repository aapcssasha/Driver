"use strict";class qbcSessionHub{constructor(){this.sh_domain=window.sh_domain||"https://cdn.quebecorhub.com",this.sh_path=window.sh_path||"/session-hub",this.sh_url=this.sh_domain+this.sh_path+"/index.html",this.default_timeout=1500,document.getElementById("qbcSessionHub")?this.iframe=document.getElementById("qbcSessionHub"):(this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.src=this.sh_url,this.iframe.setAttribute("id","qbcSessionHub"),document.body.appendChild(this.iframe))}check_origin(t){return!(!t.origin||t.origin!==this.sh_domain)}verify_payload(t){try{const e=new RegExp("[A-Fa-f0-9]{64}");return!!!!(t.data.property.hasOwnProperty("e")&&t.data.property.hasOwnProperty("e2")&&e.test(t.data.property.e)&&e.test(t.data.property.e2))}catch{return console.log("verify_payload failed"),!1}}do(t,e){var i={action:t,source:"qbcSessionHub",data:e};return document.getElementById("qbcSessionHub").contentWindow.postMessage(JSON.stringify(i),"*"),new Promise((e,i)=>{var s=setTimeout(()=>{i(t+" timeout after "+this.default_timeout+"ms")},this.default_timeout);let o=this;window.onmessage=function(i){if(void 0===i.data||void 0===i.data.indexOf||-1==i.data.indexOf("qbcSessionHub"))return!1;try{var a=JSON.parse(i.data)}catch(t){return void clearTimeout(s)}"qbcSessionHub"==a.source&&!1!==o.check_origin(i)&&a.data&&(clearTimeout(s),["ping","viewPlacement","setSessionProperty","setSessionAttribute"].indexOf(t)>-1?e(a.data.msg):"getSessionProperty"==t&&o.verify_payload(a)?e(a.data.property):e("getSessionAttribute"==t?a.data.property:"action failed"))}})}}